## 01ã€åŸºæœ¬æ¦‚å¿µï¼šç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹

* **ç¨‹åº(program)** ï¼š **ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆ** ã€‚å³æŒ‡ä¸€æ®µé™æ€çš„ä»£ç ï¼Œé™æ€å¯¹è±¡ã€‚
* **è¿›ç¨‹(process)** ï¼šç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ–æ˜¯ **æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åº** ã€‚æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ï¼šæœ‰å®ƒè‡ªèº«çš„äº§ç”Ÿã€å­˜åœ¨å’Œæ¶ˆäº¡çš„è¿‡ç¨‹ã€‚â€”â€”ç”Ÿå‘½å‘¨æœŸ

  * å¦‚ï¼šè¿è¡Œä¸­çš„QQï¼Œè¿è¡Œä¸­çš„MP3æ’­æ”¾å™¨ç¨‹åºæ˜¯é™æ€çš„ï¼Œè¿›ç¨‹æ˜¯åŠ¨æ€çš„
  * è¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„å•ä½ï¼Œç³»ç»Ÿåœ¨è¿è¡Œæ—¶ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜åŒºåŸŸ
* **çº¿ç¨‹(thread)** ï¼Œè¿›ç¨‹å¯è¿›ä¸€æ­¥ç»†åŒ–ä¸ºçº¿ç¨‹ï¼Œæ˜¯ **ä¸€ä¸ªç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„** ã€‚

  * è‹¥ä¸€ä¸ªè¿›ç¨‹åŒä¸€æ—¶é—´å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯æ”¯æŒå¤šçº¿ç¨‹çš„
  * **çº¿ç¨‹æ˜¯è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½** ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨(pc)ï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°
  * ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜å•å…ƒ/å†…å­˜åœ°å€ç©ºé—´â€”ã€‹å®ƒä»¬ä»åŒä¸€å †ä¸­åˆ†é…å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®ç›¸åŒçš„å˜é‡å’Œå¯¹è±¡ã€‚è¿™å°±ä½¿å¾—çº¿ç¨‹é—´é€šä¿¡æ›´ç®€ä¾¿ã€é«˜æ•ˆã€‚ä½†å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«çš„ç³»ç»Ÿèµ„æºå¯èƒ½å°±ä¼šå¸¦æ¥å®‰å…¨çš„éšæ‚£ã€‚

![](assets/20210123234440-20220603152651-sj0liyj.jpg)

## 1.1ã€è¿›ç¨‹ä¸çº¿ç¨‹

![](assets/20210123234436-20220603152650-37dxh9b.jpg)

> å•æ ¸CPUå’Œå¤šæ ¸CPUçš„ç†è§£
>

* å•æ ¸CPUï¼Œå…¶å®æ˜¯ä¸€ç§å‡çš„å¤šçº¿ç¨‹ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªæ—¶é—´å•å…ƒå†…ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šè™½ç„¶æœ‰å¤šè½¦é“ï¼Œä½†æ˜¯æ”¶è´¹ç«™åªæœ‰ä¸€ä¸ªå·¥ä½œäººå‘˜åœ¨æ”¶è´¹ï¼Œåªæœ‰æ”¶äº†è´¹æ‰èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆCPUå°±å¥½æ¯”æ”¶è´¹äººå‘˜ã€‚å¦‚æœæœ‰æŸä¸ªäººä¸æƒ³äº¤é’±ï¼Œé‚£ä¹ˆæ”¶è´¹äººå‘˜å¯ä»¥æŠŠä»–â€œæŒ‚èµ·â€ï¼ˆæ™¾ç€ä»–ï¼Œç­‰ä»–æƒ³é€šäº†ï¼Œå‡†å¤‡å¥½äº†é’±ï¼Œå†å»æ”¶è´¹ï¼‰ã€‚ä½†æ˜¯å› ä¸ºCPUæ—¶é—´å•å…ƒç‰¹åˆ«çŸ­ï¼Œå› æ­¤æ„Ÿè§‰ä¸å‡ºæ¥ã€‚
* å¦‚æœæ˜¯å¤šæ ¸çš„è¯ï¼Œæ‰èƒ½æ›´å¥½çš„å‘æŒ¥å¤šçº¿ç¨‹çš„æ•ˆç‡ã€‚ï¼ˆç°åœ¨çš„æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼‰
* ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºjava.exeï¼Œå…¶å®è‡³å°‘æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼šmain()ä¸»çº¿ç¨‹ï¼Œgc()åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œå¼‚å¸¸å¤„ç†çº¿ç¨‹ã€‚å½“ç„¶å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šå½±å“ä¸»çº¿ç¨‹ã€‚

> å¹¶è¡Œä¸å¹¶å‘
>

* å¹¶è¡Œï¼šå¤šä¸ªCPUåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šå¤šä¸ªäººåŒæ—¶åšä¸åŒçš„äº‹ã€‚
* å¹¶å‘ï¼šä¸€ä¸ªCPU(é‡‡ç”¨æ—¶é—´ç‰‡)åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šç§’æ€ã€å¤šä¸ªäººåšåŒä¸€ä»¶äº‹ã€‚

## 1.2ã€ä½¿ç”¨å¤šçº¿ç¨‹çš„ä¼˜ç‚¹

> èƒŒæ™¯ï¼š
>

ä»¥å•æ ¸CPUä¸ºä¾‹ï¼Œåªä½¿ç”¨å•ä¸ªçº¿ç¨‹å…ˆåå®Œæˆå¤šä¸ªä»»åŠ¡ï¼ˆè°ƒç”¨å¤šä¸ªæ–¹æ³•ï¼‰ï¼Œè‚¯å®šæ¯”ç”¨å¤šä¸ªçº¿ç¨‹æ¥å®Œæˆç”¨çš„æ—¶é—´æ›´çŸ­ï¼Œä¸ºä½•ä»éœ€å¤šçº¿ç¨‹å‘¢ï¼Ÿ

> å¤šçº¿ç¨‹ç¨‹åºçš„ä¼˜ç‚¹ï¼š
>

1. æé«˜åº”ç”¨ç¨‹åºçš„å“åº”ã€‚å¯¹å›¾å½¢åŒ–ç•Œé¢æ›´æœ‰æ„ä¹‰ï¼Œå¯å¢å¼ºç”¨æˆ·ä½“éªŒã€‚
2. æé«˜è®¡ç®—æœºç³»ç»ŸCPUçš„åˆ©ç”¨ç‡
3. æ”¹å–„ç¨‹åºç»“æ„ã€‚å°†æ—¢é•¿åˆå¤æ‚çš„è¿›ç¨‹åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹ï¼Œç‹¬ç«‹è¿è¡Œï¼Œåˆ©äºç†è§£å’Œä¿®æ”¹

## 1.3ã€ä½•æ—¶éœ€è¦å¤šçº¿ç¨‹

* ç¨‹åºéœ€è¦åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚
* ç¨‹åºéœ€è¦å®ç°ä¸€äº›éœ€è¦ç­‰å¾…çš„ä»»åŠ¡æ—¶ï¼Œå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™æ“ä½œã€ç½‘ç»œæ“ä½œã€æœç´¢ç­‰ã€‚
* éœ€è¦ä¸€äº›åå°è¿è¡Œçš„ç¨‹åºæ—¶ã€‚

## 02ã€çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨

## 2.1ã€çº¿ç¨‹çš„åˆ›å»ºå’Œå¯åŠ¨

* Javaè¯­è¨€çš„JVMå…è®¸ç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå®ƒé€šè¿‡`java.lang.Thread`ç±»æ¥ä½“ç°ã€‚
* `Thread`ç±»çš„ç‰¹æ€§

  * æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯é€šè¿‡æŸä¸ªç‰¹å®š`Thread`å¯¹è±¡çš„`run()`æ–¹æ³•æ¥å®Œæˆæ“ä½œçš„ï¼Œç»å¸¸æŠŠ`run()`æ–¹æ³•çš„ä¸»ä½“ç§°ä¸ºçº¿ç¨‹ä½“
  * é€šè¿‡è¯¥`Thread`å¯¹è±¡çš„`start()æ–¹`æ³•æ¥å¯åŠ¨è¿™ä¸ªçº¿ç¨‹ï¼Œè€Œéç›´æ¥è°ƒç”¨`run()`

## 2.2ã€[Threadç±»](https://so.csdn.net/so/search?q=Thread%E7%B1%BB&spm=1001.2101.3001.7020)

* `Thread()`ï¼šåˆ›å»ºæ–°çš„Threadå¯¹è±¡
* `Thread(String threadname)`ï¼šåˆ›å»ºçº¿ç¨‹å¹¶æŒ‡å®šçº¿ç¨‹å®ä¾‹å
* `Thread(Runnabletarget)`ï¼šæŒ‡å®šåˆ›å»ºçº¿ç¨‹çš„ç›®æ ‡å¯¹è±¡ï¼Œå®ƒå®ç°äº†Runnableæ¥å£ä¸­çš„runæ–¹æ³•
* `Thread(Runnable target, String name)`ï¼šåˆ›å»ºæ–°çš„Threadå¯¹è±¡

## 2.3ã€[API](https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020)ä¸­åˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼

* JDK1.5ä¹‹å‰åˆ›å»ºæ–°æ‰§è¡Œçº¿ç¨‹æœ‰ä¸¤ç§æ–¹æ³•ï¼š

  * ç»§æ‰¿`Thread`ç±»çš„æ–¹å¼
  * å®ç°`Runnable`æ¥å£çš„æ–¹å¼

### 2.3.1ã€åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»

```java
/**
 * å¤šçº¿ç¨‹çš„åˆ›å»ºï¼Œæ–¹å¼ä¸€ï¼šç»§æ‰¿äºThreadç±»
 * 1.åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
 * 2.é‡å†™Threadçš„run()æ–¹æ³• ---> å°†æ­¤çº¿ç¨‹çš„æ–¹æ³•å£°æ˜åœ¨run()ä¸­
 * 3.åˆ›å»ºThreadç±»çš„å­å¯¹è±¡
 * 4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start()
 *
 * ä¾‹å­:éå†100ä»¥å†…çš„æ‰€æœ‰çš„å¶æ•°
 */

//1.åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
class MyThread extends Thread{ 
    //é‡å†™Threadç±»çš„run()
    @Override
    public void run() { 
        for(int i = 1;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(i);
            }
        }
    }
}

public class ThreadTest { 
    public static void main(String[] args) { 
        //3.åˆ›å»ºThreadç±»çš„å­å¯¹è±¡
        MyThread t1 = new MyThread();

        //4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start():â‘ å¯åŠ¨å½“å‰çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
        t1.start();

        //å¦‚ä¸‹æ“ä½œä»åœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œçš„
        for(int i = 1;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(i + "***main()***");
            }
        }
    }
}
123456789101112131415161718192021222324252627282930313233343536373839
```

> mtå­çº¿ç¨‹çš„åˆ›å»ºå’Œå¯åŠ¨è¿‡ç¨‹
>

![](assets/4e851e2caa89df9b9838a273ad69249d-20220603152651-nin8ohl.png)  
 ![](assets/04e20e90637405c92469045cac1fbb54-20220603152651-bzmkl7s.png)

### 2.3.2ã€åˆ›å»ºè¿‡ç¨‹ä¸­çš„ä¸¤ä¸ªé—®é¢˜è¯´æ˜

```java
//1.åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
class MyThread extends Thread{ 
    //é‡å†™Threadç±»çš„run()
    @Override
    public void run() { 
        for(int i = 1;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}

public class ThreadTest { 
    public static void main(String[] args) { 
        //3.åˆ›å»ºThreadç±»çš„å­å¯¹è±¡
        MyThread t1 = new MyThread();

        //4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start():â‘ å¯åŠ¨å½“å‰çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
        t1.start();
        //é—®é¢˜1:æˆ‘ä»¬ä¸èƒ½é€šè¿‡ç›´æ¥è°ƒç”¨run()çš„æ–¹å¼å¯åŠ¨çº¿ç¨‹ã€‚
//        t1.run();

        //é—®é¢˜äºŒ:å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°ã€‚ä¸å¯ä»¥è¿˜è®©å·²ç»start()çš„çº¿ç¨‹å»æ‰§è¡Œã€‚ä¼šæŠ¥IllegalThreadStateException
//        t1.start();
        //æˆ‘ä»¬éœ€è¦é‡ç°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å¯¹è±¡ï¼Œå»start().
        MyThread t2 = new MyThread();
        t2.start();

        //å¦‚ä¸‹æ“ä½œä»åœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œçš„
        for(int i = 1;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i + "***main()***");
            }
        }
    }
}
12345678910111213141516171819202122232425262728293031323334353637
```

### 2.3.3ã€ç»ƒä¹ 1

> 1ã€å†™æ³•ä¸€
>

```java
/**
 * ç»ƒä¹ :åˆ›å»ºä¸¤ä¸ªåˆ†çº¿ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªéå†100ä»¥å†…çš„å¶æ•°ï¼Œå¦ä¸€ä¸ªéå†100ä»¥å†…çš„å¥‡æ•°
 */
public class ThreadDemo { 
    public static void main(String[] args) { 
        MyThread m1 = new MyThread();
        m1.start();

        MyThread2 m2 = new MyThread2();
        m2.start();
    }
}
class MyThread extends Thread{ 
    @Override
    public void run() { 
        for(int i = 0;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}
class MyThread2 extends Thread{ 
    @Override
    public void run() { 
        for(int i = 0;i < 100;i++){ 
            if(i % 2 != 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}
1234567891011121314151617181920212223242526272829303132
```

> 2ã€å†™æ³•äºŒ
>

```java
/**
 * ç»ƒä¹ :åˆ›å»ºä¸¤ä¸ªåˆ†çº¿ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªéå†100ä»¥å†…çš„å¶æ•°ï¼Œå¦ä¸€ä¸ªéå†100ä»¥å†…çš„å¥‡æ•°
 */
public class ThreadDemo { 
    public static void main(String[] args) { 

        //åˆ›å»ºThreadç±»çš„åŒ¿åå­ç±»çš„æ–¹å¼
        new Thread(){ 
            @Override
            public void run() { 
                for(int i = 0;i < 100;i++){ 
                    if(i % 2 == 0){ 
                        System.out.println(Thread.currentThread().getName() + ":" + i);
                    }
                }
            }
        }.start();

        new Thread(){ 
            @Override
            public void run() { 
                for(int i = 0;i < 100;i++){ 
                    if(i % 2 != 0){ 
                        System.out.println(Thread.currentThread().getName() + ":" + i);
                    }
                }
            }
        }.start();
    }
}
123456789101112131415161718192021222324252627282930
```

### 2.3.4ã€Threadç±»çš„æœ‰å…³æ–¹æ³•

```java
/**
 * æµ‹è¯•Threadç±»çš„å¸¸ç”¨æ–¹æ³•
 * 1.start():å¯åŠ¨å½“å‰çº¿ç¨‹ï¼Œæ‰§è¡Œå½“å‰çº¿ç¨‹çš„run()
 * 2.run():é€šå¸¸éœ€è¦é‡å†™Threadç±»ä¸­çš„æ­¤æ–¹æ³•ï¼Œå°†åˆ›å»ºçš„çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨æ­¤æ–¹æ³•ä¸­
 * 3.currentThread(): é™æ€æ–¹æ³•ï¼Œè¿”å›å½“å‰ä»£ç æ‰§è¡Œçš„çº¿ç¨‹
 * 4.getName():è·å–å½“å‰çº¿ç¨‹çš„åå­—
 * 5.setName():è®¾ç½®å½“å‰çº¿ç¨‹çš„åå­—
 * 6.yield():é‡Šæ”¾å½“å‰CPUçš„æ‰§è¡Œæƒ
 * 7.join():åœ¨çº¿ç¨‹aä¸­è°ƒç”¨çº¿ç¨‹bçš„join(),æ­¤æ—¶çº¿ç¨‹aå°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹bå®Œå…¨æ‰§è¡Œå®Œä»¥åï¼Œçº¿ç¨‹aæ‰
 *          ç»“æŸé˜»å¡çŠ¶æ€ã€‚
 * 8.stop():å·²è¿‡æ—¶ã€‚å½“æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå¼ºåˆ¶ç»“æŸå½“å‰çº¿ç¨‹ã€‚
 * 9.sleep(long millitime)ï¼šè®©å½“å‰çº¿ç¨‹â€œç¡çœ â€æŒ‡å®šæ—¶é—´çš„millitimeæ¯«ç§’)ã€‚åœ¨æŒ‡å®šçš„millitimeæ¯«ç§’æ—¶é—´å†…ï¼Œ
 *                          å½“å‰çº¿ç¨‹æ˜¯é˜»å¡çŠ¶æ€çš„ã€‚
 * 10.isAlive()ï¼šè¿”å›booleanï¼Œåˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¿˜æ´»ç€
 */

class HelloThread extends Thread{ 
    @Override
    public void run() { 
        for(int i = 0;i < 100; i++){ 

            try { 
                sleep(10);
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }

            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
//            if(i % 20 == 0){ 
//                yield();
//            }
        }
    }

    public HelloThread(String name){ 
        super(name);
    }
}

public class ThreadModeTest { 
    public static void main(String[] args) { 
        HelloThread h1 = new HelloThread("Thread : 1");

//        h1.setName("çº¿ç¨‹ä¸€");

        h1.start();

        //ç»™ä¸»çº¿ç¨‹å‘½å
        Thread.currentThread().setName("ä¸»çº¿ç¨‹");

        for(int i = 0;i < 100; i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }

            if(i == 20){ 
                try { 
                    h1.join();
                } catch (InterruptedException e) { 
                    e.printStackTrace();
                }
            }
        }

        System.out.println(h1.isAlive());
    }
}
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869
```

### 2.3.5ã€çº¿ç¨‹çš„è°ƒåº¦

* è°ƒåº¦ç­–ç•¥

  * æ—¶é—´ç‰‡  
    â€‹![](assets/df274b909314af5c7603df80e60c64f9-20220603152650-hn4f9f0.png)
  * **æŠ¢å å¼ï¼šé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æŠ¢å CPU**
* Javaçš„è°ƒåº¦æ–¹æ³•

  * åŒä¼˜å…ˆçº§çº¿ç¨‹ç»„æˆå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆå…ˆåˆ°å…ˆæœåŠ¡ï¼‰ï¼Œä½¿ç”¨æ—¶é—´ç‰‡ç­–ç•¥
  * å¯¹é«˜ä¼˜å…ˆçº§ï¼Œä½¿ç”¨ä¼˜å…ˆè°ƒåº¦çš„æŠ¢å å¼ç­–ç•¥

### 2.3.6ã€çº¿ç¨‹çš„[ä¼˜å…ˆçº§](https://so.csdn.net/so/search?q=%E4%BC%98%E5%85%88%E7%BA%A7&spm=1001.2101.3001.7020)

```java
/**
 * - çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰çº§
 *   - MAX_PRIORITYï¼š10
 *   - MIN _PRIORITYï¼š1
 *   - NORM_PRIORITYï¼š5 --->é»˜è®¤ä¼˜å…ˆçº§
 * - æ¶‰åŠçš„æ–¹æ³•
 *   - getPriority() ï¼šè¿”å›çº¿ç¨‹ä¼˜å…ˆå€¼
 *   - setPriority(intnewPriority) ï¼šæ”¹å˜çº¿ç¨‹çš„ä¼˜å…ˆçº§
 *
 *   è¯´æ˜:é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹è¦æŠ¢å ä½ä¼˜å…ˆçº§çº¿ç¨‹cpuçš„æ‰§è¡Œæƒã€‚
 *       ä½†æ˜¯åªæ˜¯ä»æ¦‚ç‡ä¸Šè®²ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹é«˜æ¦‚ç‡çš„æƒ…å†µä¸‹è¢«æ‰§è¡Œã€‚
 *       å¹¶ä¸æ„å‘³ç€åªæœ‰å½“é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰§è¡Œå®Œä»¥åï¼Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰ä¼šè¢«æ‰§è¡Œã€‚
 */

class HelloThread extends Thread { 
    @Override
    public void run() { 
        for (int j = 0; j < 100; j++) { 

//            try { 
//                sleep(10);
//            } catch (InterruptedException e) { 
//                e.printStackTrace();
//            }

            if (j % 2 == 0) { 
                System.out.println(getName() + ":" + getPriority() + ":" + j);
            }
        }
    }
    public HelloThread(String name){ 
        super(name);
    }
}

public class ThreadModeTest { 
    public static void main(String[] args) { 
        HelloThread h2 = new HelloThread("Thread : 1");
        h2.start();

        //è®¾ç½®åˆ†çº¿ç¨‹çš„ä¼˜å…ˆçº§
        h2.setPriority(Thread.MAX_PRIORITY);

        //ç»™ä¸»çº¿ç¨‹å‘½å
        Thread.currentThread().setName("ä¸»çº¿ç¨‹");
        Thread.currentThread().setPriority((Thread.MIN_PRIORITY));

        for(int j = 0;j < 100; j++){ 
            if(j % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + Thread.currentThread().getPriority() + ":" + j);
            }

//            if(j == 20){ 
//                try { 
//                    h2.join();
//                } catch (InterruptedException e) { 
//                    e.printStackTrace();
//                }
//            }
        }

        System.out.println(h2.isAlive());
    }
}
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364
```

### 2.3.7ã€ç»ƒä¹ 2

> 1ã€å¤šçª—å£å–ç¥¨
>

```java
/**
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªcçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ 
 *
 * å­˜åœ¨çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ï¼Œå¾…è§£å†³ã€‚
 */
class Windows extends Thread{ 

    private static int ticket = 100;

    @Override
    public void run() { 
        while(true){ 
            if(ticket > 0){ 
                System.out.println(getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                ticket--;
            }else{ 
                break;
            }
        }
    }
}

public class WindowsTest { 
    public static void main(String[] args) { 
        Windows t1 = new Windows();
        Windows t2 = new Windows();
        Windows t3 = new Windows();

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
12345678910111213141516171819202122232425262728293031323334353637
```

### 2.3.8ã€åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£

```java
/**
 * åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£
 * 1.åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£å¾—ç±»
 * 2.å®ç°ç±»å»å®ç°Runnableä¸­çš„æŠ½è±¡æ–¹æ³•:run()
 * 3.åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
 * 4.å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
 * 5.é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start()
 */
//1.åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£å¾—ç±»
class MThread implements Runnable{ 

    //2.å®ç°ç±»å»å®ç°Runnableä¸­çš„æŠ½è±¡æ–¹æ³•:run()
    @Override
    public void run() { 
        for(int i = 0;i < 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}

public class ThreadTest1 { 
    public static void main(String[] args) { 
        //3.åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
        MThread m1 = new MThread();
        //4.å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
        Thread t1 = new Thread(m1);
        //5.é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start():â‘ å¯åŠ¨çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run() --> è°ƒç”¨äº†Runnableç±»å‹çš„targetçš„run()
        t1.start();

        //å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°
        Thread t2 = new Thread(m1);
        t2.setName("çº¿ç¨‹2");
        t2.start();
    }
}
12345678910111213141516171819202122232425262728293031323334353637
```

### 2.3.9ã€ç»§æ‰¿æ–¹å¼å’Œå®ç°æ–¹å¼çš„è”ç³»ä¸åŒºåˆ«

```java
/**
 *  æ¯”è¾ƒåˆ›å»ºçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼ã€‚
 *  å¼€å‘ä¸­ï¼šä¼˜å…ˆé€‰æ‹©ï¼šå®ç°Runnableæ¥å£çš„æ–¹å¼
 *  åŸå› ï¼š1. å®ç°çš„æ–¹å¼æ²¡æœ‰ç±»çš„å•ç»§æ‰¿æ€§çš„å±€é™æ€§
 *       2. å®ç°çš„æ–¹å¼æ›´é€‚åˆæ¥å¤„ç†å¤šä¸ªçº¿ç¨‹æœ‰å…±äº«æ•°æ®çš„æƒ…å†µã€‚
 *  
 *  è”ç³»ï¼špublic class Thread implements Runnable
 *  ç›¸åŒç‚¹ï¼šä¸¤ç§æ–¹å¼éƒ½éœ€è¦é‡å†™run(),å°†çº¿ç¨‹è¦æ‰§è¡Œçš„é€»è¾‘å£°æ˜åœ¨run()ä¸­ã€‚
 */
123456789
```

### 2.3.10ã€è¡¥å……ï¼šçº¿ç¨‹çš„åˆ†ç±»

> Javaä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚
>

* å®ƒä»¬åœ¨å‡ ä¹æ¯ä¸ªæ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ¤æ–­JVMä½•æ—¶ç¦»å¼€ã€‚
* å®ˆæŠ¤çº¿ç¨‹æ˜¯ç”¨æ¥æœåŠ¡ç”¨æˆ·çº¿ç¨‹çš„ï¼Œé€šè¿‡åœ¨`start()`æ–¹æ³•å‰è°ƒç”¨**`thread.setDaemon(true)`**å¯ä»¥æŠŠä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å˜æˆä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚
* Javaåƒåœ¾å›æ”¶å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ã€‚
* è‹¥JVMä¸­éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“å‰JVMå°†é€€å‡ºã€‚
* å½¢è±¡ç†è§£ï¼šå…”æ­»ç‹—çƒ¹ï¼Œé¸Ÿå°½å¼“è—

## 03ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

> JDKä¸­ç”¨Thread.Stateç±»å®šä¹‰äº†çº¿ç¨‹çš„å‡ ç§çŠ¶æ€
>

* æ–°å»ºï¼šå½“ä¸€ä¸ªThreadç±»æˆ–å…¶å­ç±»çš„å¯¹è±¡è¢«å£°æ˜å¹¶åˆ›å»ºæ—¶ï¼Œæ–°ç”Ÿçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€
* å°±ç»ªï¼šå¤„äºæ–°å»ºçŠ¶æ€çš„çº¿ç¨‹è¢«`start()`åï¼Œå°†è¿›å…¥çº¿ç¨‹é˜Ÿåˆ—ç­‰å¾…CPUæ—¶é—´ç‰‡ï¼Œæ­¤æ—¶å®ƒå·²å…·å¤‡äº†è¿è¡Œçš„æ¡ä»¶ï¼Œåªæ˜¯æ²¡åˆ†é…åˆ°CPUèµ„æº
* è¿è¡Œï¼šå½“å°±ç»ªçš„çº¿ç¨‹è¢«è°ƒåº¦å¹¶è·å¾—CPUèµ„æºæ—¶,ä¾¿è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œ`run()`æ–¹æ³•å®šä¹‰äº†çº¿ç¨‹çš„æ“ä½œå’ŒåŠŸèƒ½
* é˜»å¡ï¼šåœ¨æŸç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¢«äººä¸ºæŒ‚èµ·æˆ–æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ—¶ï¼Œè®©å‡ºCPUå¹¶ä¸´æ—¶ä¸­æ­¢è‡ªå·±çš„æ‰§è¡Œï¼Œè¿›å…¥é˜»å¡çŠ¶æ€
* æ­»äº¡ï¼šçº¿ç¨‹å®Œæˆäº†å®ƒçš„å…¨éƒ¨å·¥ä½œæˆ–çº¿ç¨‹è¢«æå‰å¼ºåˆ¶æ€§åœ°ä¸­æ­¢æˆ–å‡ºç°å¼‚å¸¸å¯¼è‡´ç»“æŸ

> çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
>

![](assets/b29133ad93d3839d259de57bbfa1397a-20220603152651-sso4eqz.png)

## 04ã€çº¿ç¨‹çš„åŒæ­¥

> 1ã€æå‡ºé—®é¢˜ï¼š
>
>  å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„ä¸ç¡®å®šæ€§å¼•èµ·æ‰§è¡Œç»“æœçš„ä¸ç¨³å®š
>
>  å¤šä¸ªçº¿ç¨‹å¯¹è´¦æœ¬çš„å…±äº«ï¼Œä¼šé€ æˆæ“ä½œçš„ä¸å®Œæ•´æ€§ï¼Œä¼šç ´åæ•°æ®ã€‚
>

![](assets/b10da50b242810bf311c0f7f8062e729-20220603152651-bs2fhkk.png)

> 2ã€ä¾‹é¢˜ï¼šæ¨¡æ‹Ÿç«è½¦ç«™å”®ç¥¨ç¨‹åºï¼Œå¼€å¯ä¸‰ä¸ªçª—å£å”®ç¥¨ã€‚
>

```java
class Windows1 implements Runnable{ 

    private int ticket = 100;

    @Override
    public void run() { 
        while(true){ 
            if(ticket > 0){ 
                System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                ticket--;
            }else{ 
                break;
            }
        }
    }
}

public class WindowsTest1 { 
    public static void main(String[] args) { 
        Windows1 w = new Windows1();

        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
12345678910111213141516171819202122232425262728293031323334
```

> 3ã€ç†æƒ³çŠ¶æ€
>

![](assets/7a640e36cea308b9eeaabe6e715eb4bd-20220603152650-94qlhm8.png)

> 4ã€æç«¯çŠ¶æ€
>

![](assets/3b3d209bdf2c3351f5f525a73eacea0a-20220603152651-amv5zh8.png)

## 4.1ã€åŒæ­¥ä»£ç å—å¤„ç†å®ç°Runnableçš„çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
/**
 *  ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ .ä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼
 *  1.å–ç¥¨è¿‡ç¨‹ä¸­å‡ºç°é‡ç¥¨ã€é”™ç¥¨ ---ã€‹å‡ºç°äº†çº¿ç¨‹çš„å®‰å…¨é—®é¢˜
 *  2.é—®é¢˜å‡ºç°çš„åŸå› :å½“æŸä¸ªçº¿ç¨‹æ“ä½œè½¦ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œå°šæœªæ“ä½œå®Œæˆæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å‚ä¸è¿›æ¥ï¼Œä¹Ÿæ“ä½œè½¦ç¥¨
 *  3.å¦‚ä½•è§£å†³ï¼šå½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œticketçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å‚ä¸è¿›æ¥ã€‚ç›´åˆ°çº¿ç¨‹aæ“ä½œå®Œticketæ—¶ï¼Œå…¶ä»–
 *            çº¿ç¨‹æ‰å¯ä»¥æ“ä½œticketã€‚è¿™ç§æƒ…å†µå³ä½¿çº¿ç¨‹aå‡ºç°äº†é˜»å¡ï¼Œä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚
 *  4.åœ¨javaä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åŒæ­¥æœºåˆ¶ï¼Œæ¥è§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ã€‚
 *
 *  æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—
 *  synchronized(åŒæ­¥ç›‘è§†å™¨){
 *      //éœ€è¦è¢«åŒæ­¥çš„ä»£ç 
 *
 *  }
 *  è¯´æ˜ï¼š1.æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ï¼Œå³ä¸ºéœ€è¦è¢«åŒæ­¥çš„ä»£ç  --->ä¸èƒ½åŒ…å«ä»£ç å¤šäº†ï¼Œä¹Ÿä¸èƒ½åŒ…å«ä»£ç å°‘äº†ã€‚
 *       2.å…±äº«æ•°æ®ï¼šå¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œçš„å˜é‡ã€‚æ¯”å¦‚ï¼šticketå°±æ˜¯å…±äº«æ•°æ®
 *       3.åŒæ­¥ç›‘è§†å™¨ï¼Œä¿—ç§°ï¼šé”ã€‚ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥æ¥å……å½“é”ã€‚
 *          è¦æ±‚ï¼šå¤šä¸ªçº¿ç¨‹å¿…é¡»è¦å…±ç”¨åŒä¸€æŠŠé”ã€‚
 *
 *       è¡¥å……ï¼šåœ¨å®ç°Runnableæ¥å£åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨thiså……å½“åŒæ­¥ç›‘è§†å™¨ã€‚
 *
 *  æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•
 *      å¦‚æœæ“ä½œå…±äº«æ•°æ®çš„ä»£ç å®Œæ•´çš„å£°æ˜åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸å¦¨å°†æ­¤æ–¹æ³•å£°æ˜åŒæ­¥çš„
 *
 *  5.åŒæ­¥çš„æ–¹å¼ï¼Œè§£å†³äº†çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ã€‚---å¥½å¤„
 *    æ“ä½œåŒæ­¥ä»£ç æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„è¿‡ç¨‹ï¼Œæ•ˆç‡ä½ã€‚---å±€é™æ€§
 */

class Windows1 implements Runnable{ 

    private int ticket = 100;
//    Object obj = new Object();
//    Dog dog = new Dog();

    @Override
    public void run() { 
        while(true){ 
            synchronized (this) { //æ­¤æ—¶çš„this:å”¯ä¸€çš„windows1çš„å¯¹è±¡ //æ–¹å¼äºŒ:synchronized (dog) { 
                if (ticket > 0) { 

                    try{ 
                        Thread.sleep(100);
                    }catch (InterruptedException e){ 
                        e.printStackTrace();
                    }

                    System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                    ticket--;
                } else { 
                    break;
                }
            }
        }
    }
}

public class WindowsTest1 { 
    public static void main(String[] args) { 
        Windows1 w = new Windows1();

        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
class Dog{ 

}
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475
```

> åˆ†æåŒæ­¥åŸç†
>

![](assets/3d05078b85d041ca81c335b48afa8607-20220603152651-6wr09yv.png)

## 4.2ã€åŒæ­¥ä»£ç å—å¤„ç†ç»§æ‰¿Threadç±»çš„çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
/**
 * ä½¿ç”¨åŒæ­¥ä»£ç å—è§£å†³ç»§æ‰¿Threadç±»çš„æ–¹å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
 *
 * ä¾‹å­ï¼šåˆ›å»ºä¸‰ä¸ªcçª—å£å–ç¥¨ï¼Œæ€»ç¥¨æ•°ä¸º100å¼ 
 */
class Windows extends Thread{ 

    private static int ticket = 100;
    private static Object obj = new Object();

    @Override
    public void run() { 
        while(true){ 
            //æ­£ç¡®çš„
//            synchronized (obj) { 
            synchronized (Windows.class){    //Class clazz = Windows.class
            //é”™è¯¯çš„ï¼Œå› ä¸ºæ­¤æ—¶thisè¡¨ç¤ºçš„æ˜¯t1,t2,t3ä¸‰ä¸ªå¯¹è±¡
//            synchronized (this) { 
                if (ticket > 0) { 

                    try { 
                        Thread.sleep(100);
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                    System.out.println(getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                    ticket--;
                } else { 
                    break;
                }
            }
        }
    }
}

public class WindowsTest2 { 
    public static void main(String[] args) { 
        Windows t1 = new Windows();
        Windows t2 = new Windows();
        Windows t3 = new Windows();

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051
```

## 4.3ã€åŒæ­¥æ–¹æ³•å¤„ç†å®ç°Runnableçš„çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
/**
 * ä½¿ç”¨åŒæ­¥æ–¹æ³•è§£å†³å®ç°Runnableæ¥å£çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
 *
 * å…³äºåŒæ­¥æ–¹æ³•çš„æ€»ç»“:
 *  1. åŒæ­¥æ–¹æ³•ä»ç„¶æ¶‰åŠåˆ°åŒæ­¥ç›‘è§†å™¨ï¼Œåªæ˜¯ä¸éœ€è¦æˆ‘ä»¬æ˜¾å¼çš„å£°æ˜ã€‚
 *  2. éé™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šthis
 *     é™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šå½“å‰ç±»æœ¬èº«
 */

class Windows3 implements Runnable { 

    private int ticket = 100;

    @Override
    public void run() { 
        while (true) { 
            show();
        }
    }

    public synchronized void show() {  //åŒæ­¥ç›‘è§†å™¨:this
//        synchronized (this){ 
            if (ticket > 0) { 
                try { 
                    Thread.sleep(100);
                } catch (InterruptedException e) { 
                    e.printStackTrace();
                }
                System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                ticket--;
            }
//        }
    }
}

public class WindowsTest3 { 
    public static void main(String[] args) { 
        Windows3 w3 = new Windows3();

        Thread t1 = new Thread(w3);
        Thread t2 = new Thread(w3);
        Thread t3 = new Thread(w3);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152
```

## 4.4ã€åŒæ­¥æ–¹æ³•å¤„ç†ç»§æ‰¿Threadç±»çš„çº¿ç¨‹å®‰å…¨é—®é¢˜

```java
/**
 * ä½¿ç”¨åŒæ­¥æ–¹æ³•å¤„ç†ç»§æ‰¿Threadç±»çš„æ–¹å¼ä¸­çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
 */
class Windows4 extends Thread { 

    private static int ticket = 100;

    @Override
    public void run() { 

        while (true) { 

            show();
        }

    }
    private static synchronized void show(){ //åŒæ­¥ç›‘è§†å™¨ï¼šWindow4.class
        //private synchronized void show(){ //åŒæ­¥ç›‘è§†å™¨ï¼št1,t2,t3ã€‚æ­¤ç§è§£å†³æ–¹å¼æ˜¯é”™è¯¯çš„
        if (ticket > 0) { 

            try { 
                Thread.sleep(100);
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }

            System.out.println(Thread.currentThread().getName() + "ï¼šå–ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);
            ticket--;
        }
    }
}


public class WindowsTest4 { 
    public static void main(String[] args) { 
        Windows4 t1 = new Windows4();
        Windows4 t2 = new Windows4();
        Windows4 t3 = new Windows4();


        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();

    }
}
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950
```

## 4.5ã€çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ä¹‹æ‡’æ±‰å¼

```java
/**
 * ä½¿ç”¨åŒæ­¥æœºåˆ¶å°†å•ä¾‹æ¨¡å¼ä¸­çš„æ‡’æ±‰å¼æ”¹å†™ä¸ºçº¿ç¨‹å®‰å…¨çš„
 */
public class BankTest { 
}
class Bank{ 

    private Bank(){ }

    private static Bank instance = null;

    public static Bank getInstance(){ 
        //æ–¹å¼ä¸€ï¼šæ•ˆç‡ç¨å·®
        //å¿«æ·é”®:Alt+Shift+Z
//        synchronized (Bank.class) { 
//            if(instance == null){ 
//                instance = new Bank();
//            }
//            return instance;
//        }

        //æ–¹å¼äºŒï¼šæ•ˆç‡è¾ƒé«˜
        if(instance == null) { 
            synchronized (Bank.class) { 
                if (instance == null) { 
                    instance = new Bank();
                }
            }
        }
        return instance;
    }
}
1234567891011121314151617181920212223242526272829303132
```

## 4.6ã€æ­»é”çš„é—®é¢˜

> 1ã€ä¾‹1
>

```java
/**
 * æ¼”ç¤ºçº¿ç¨‹çš„æ­»é”
 *
 * 1.æ­»é”çš„ç†è§£ï¼šä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å ç”¨å¯¹æ–¹éœ€è¦çš„åŒæ­¥èµ„æºä¸æ”¾å¼ƒï¼Œ
 *       éƒ½åœ¨ç­‰å¾…å¯¹æ–¹æ”¾å¼ƒè‡ªå·±éœ€è¦çš„åŒæ­¥èµ„æºï¼Œå°±å½¢æˆäº†çº¿ç¨‹çš„æ­»é”
 * 2.è¯´æ˜:
 *      ã€‹å‡ºç°æ­»é”åï¼Œä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œä¸ä¼šå‡ºç°æç¤ºï¼Œåªæ˜¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•ç»§ç»­
 *      ã€‹æˆ‘ä»¬ä½¿ç”¨åŒæ­¥æ—¶ï¼Œè¦é¿å…å‡ºç°æ­»é”ã€‚
 */
public class ThreadTest { 
    public static void main(String[] args) { 

        StringBuffer s1 = new StringBuffer();
        StringBuffer s2 = new StringBuffer();

        new Thread(){ 
            @Override
            public void run() { 

                synchronized (s1){ 
                    s1.append("a");
                    s2.append("1");

                    try { 
                        Thread.sleep(100);
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                    synchronized (s2){ 
                        s1.append("b");
                        s2.append("2");

                        System.out.println(s1);
                        System.out.println(s2);
                    }
                }
            }
        }.start();

        new Thread(new Runnable() { 
            @Override
            public void run() { 
                synchronized (s2){ 
                    s1.append("c");
                    s2.append("3");

                    try { 
                        Thread.sleep(100);
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                    synchronized (s1){ 
                        s1.append("d");
                        s2.append("4");

                        System.out.println(s1);
                        System.out.println(s2);
                    }
                }
            }
        }).start();
    }
}
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465
```

> 2ã€ä¾‹2
>

```java
class A { 
	public synchronized void foo(B b) { 
		System.out.println("å½“å‰çº¿ç¨‹å: " + Thread.currentThread().getName()
				+ " è¿›å…¥äº†Aå®ä¾‹çš„fooæ–¹æ³•"); // â‘ 
		try { 
			Thread.sleep(200);
		} catch (InterruptedException ex) { 
			ex.printStackTrace();
		}
		System.out.println("å½“å‰çº¿ç¨‹å: " + Thread.currentThread().getName()
				+ " ä¼å›¾è°ƒç”¨Bå®ä¾‹çš„lastæ–¹æ³•"); // â‘¢
		b.last();
	}

	public synchronized void last() { 
		System.out.println("è¿›å…¥äº†Aç±»çš„lastæ–¹æ³•å†…éƒ¨");
	}
}

class B { 
	public synchronized void bar(A a) { 
		System.out.println("å½“å‰çº¿ç¨‹å: " + Thread.currentThread().getName()
				+ " è¿›å…¥äº†Bå®ä¾‹çš„baræ–¹æ³•"); // â‘¡
		try { 
			Thread.sleep(200);
		} catch (InterruptedException ex) { 
			ex.printStackTrace();
		}
		System.out.println("å½“å‰çº¿ç¨‹å: " + Thread.currentThread().getName()
				+ " ä¼å›¾è°ƒç”¨Aå®ä¾‹çš„lastæ–¹æ³•"); // â‘£
		a.last();
	}

	public synchronized void last() { 
		System.out.println("è¿›å…¥äº†Bç±»çš„lastæ–¹æ³•å†…éƒ¨");
	}
}

public class DeadLock implements Runnable { 
	A a = new A();
	B b = new B();

	public void init() { 
		Thread.currentThread().setName("ä¸»çº¿ç¨‹");
		// è°ƒç”¨aå¯¹è±¡çš„fooæ–¹æ³•
		a.foo(b);
		System.out.println("è¿›å…¥äº†ä¸»çº¿ç¨‹ä¹‹å");
	}

	public void run() { 
		Thread.currentThread().setName("å‰¯çº¿ç¨‹");
		// è°ƒç”¨bå¯¹è±¡çš„baræ–¹æ³•
		b.bar(a);
		System.out.println("è¿›å…¥äº†å‰¯çº¿ç¨‹ä¹‹å");
	}

	public static void main(String[] args) { 
		DeadLock dl = new DeadLock();
		new Thread(dl).start();
		dl.init();
	}
}
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162
```

## 4.7ã€Locké”æ–¹å¼è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜

* `java.util.concurrent.locks.Lock`æ¥å£æ˜¯æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ã€‚é”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹`Lock`å¯¹è±¡åŠ é”ï¼Œçº¿ç¨‹å¼€å§‹è®¿é—®å…±äº«èµ„æºä¹‹å‰åº”å…ˆè·å¾—`Lock`å¯¹è±¡ã€‚
* `ReentrantLock`ç±»å®ç°äº†`Lock` ï¼Œå®ƒæ‹¥æœ‰ä¸`synchronized`ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯`ReentrantLock`ï¼Œå¯ä»¥æ˜¾å¼åŠ é”ã€é‡Šæ”¾é”ã€‚
* ä»JDK 5.0å¼€å§‹ï¼ŒJavaæä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡æ¥å®ç°åŒæ­¥ã€‚åŒæ­¥é”ä½¿ç”¨`Lock`å¯¹è±¡å……å½“ã€‚

```java
import java.util.concurrent.locks.ReentrantLock;

/**
 * è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹å¼ä¸‰ï¼šlocké”---ã€‹JDK5.0æ–°å¢
 *
 * æ³¨æ„ï¼šå¦‚æœåŒæ­¥ä»£ç æœ‰å¼‚å¸¸ï¼Œè¦å°†unlock()å†™å…¥finallyè¯­å¥å—
 *
 * 1. é¢è¯•é¢˜ï¼šsynchronized ä¸ Lockçš„å¼‚åŒï¼Ÿ
 *    ç›¸åŒï¼šäºŒè€…éƒ½å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜
 *    ä¸åŒï¼šsynchronizedæœºåˆ¶åœ¨æ‰§è¡Œå®Œç›¸åº”çš„åŒæ­¥ä»£ç ä»¥åï¼Œè‡ªåŠ¨çš„é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨
 *         Lockéœ€è¦æ‰‹åŠ¨çš„å¯åŠ¨åŒæ­¥ï¼ˆlock()ï¼‰ï¼ŒåŒæ—¶ç»“æŸåŒæ­¥ä¹Ÿéœ€è¦æ‰‹åŠ¨çš„å®ç°ï¼ˆunlock()ï¼‰
 *
 * 2.ä¼˜å…ˆä½¿ç”¨é¡ºåºï¼š
 *      Lock ïƒ åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æºï¼‰ïƒ åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“ä¹‹å¤–ï¼‰
 *
 * é¢è¯•é¢˜ï¼šå¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿæœ‰å‡ ç§æ–¹å¼
 */

class Windows implements Runnable{ 

    private int ticket = 100;
    //1.å®ä¾‹åŒ–ReentrantLock
    private ReentrantLock lock = new ReentrantLock();


    @Override
    public void run() { 
        while(true){ 
            try{ 

                //è°ƒç”¨é”å®šæ–¹æ³•ï¼šlock()
                lock.lock();

                if(ticket > 0){ 

                    try { 
                        Thread.sleep(100);
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                    System.out.println(Thread.currentThread().getName() + ":å”®ç¥¨ï¼Œç¥¨å·ä¸º: " + ticket);
                    ticket --;
                }else{ 
                    break;
                }
            }finally { 
                //3.è°ƒç”¨è§£é”æ–¹æ³•ï¼šunlock()
                lock.unlock();
            }
        }
    }
}

public class LockTest { 
    public static void main(String[] args) { 
        Windows w = new Windows();

        Thread t1 = new Thread(w);
        Thread t2 = new Thread(w);
        Thread t3 = new Thread(w);

        t1.setName("çª—å£1");
        t2.setName("çª—å£2");
        t3.setName("çª—å£3");

        t1.start();
        t2.start();
        t3.start();
    }
}
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071
```

> ç»ƒä¹ 
>

```java
/**
 * é“¶è¡Œæœ‰ä¸€ä¸ªè´¦æˆ·ã€‚
 * æœ‰ä¸¤ä¸ªå‚¨æˆ·åˆ†åˆ«å‘åŒä¸€ä¸ªè´¦æˆ·å­˜3000å…ƒï¼Œæ¯æ¬¡å­˜1000ï¼Œå­˜3æ¬¡ã€‚
 * æ¯æ¬¡å­˜å®Œæ‰“å°è´¦æˆ·ä½™é¢ã€‚
 *
 * åˆ†æï¼š
 *      1.æ˜¯å¦æ˜¯å¤šçº¿ç¨‹é—®é¢˜ï¼Ÿæ˜¯ï¼Œä¸¤ä¸ªå‚¨æˆ·çº¿ç¨‹
 *      2.æ˜¯å¦æœ‰å…±äº«æ•°æ®ï¼Ÿæœ‰ï¼Œè´¦æˆ·ï¼ˆæˆ–è´¦æˆ·ä½™é¢ï¼‰
 *      3.æ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿæœ‰
 *      4.éœ€è¦è€ƒè™‘å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŸåŒæ­¥æœºåˆ¶ï¼šæœ‰ä¸‰ç§æ–¹å¼ã€‚
 */
class Account{ 
    private double balance;

    public Account(double balance){ 
        this.balance = balance;
    }

    //å­˜é’±
    public synchronized void deposit(double amt){ 
        if(amt > 0){ 

            try { 
                Thread.sleep(1000);
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }

            balance += amt;
            System.out.println(Thread.currentThread().getName() + ":" + "å­˜é’±æˆåŠŸï¼Œå½“å‰ä½™é¢:" + balance);
        }
    }
}

class Customer extends Thread{ 

    private Account acct;
    public Customer(Account acct){ 
        this.acct = acct;
    }

    @Override
    public void run() { 

        for(int i = 0;i < 3;i++){ 
            acct.deposit(1000);
        }
    }
}

public class AccountTest { 
    public static void main(String[] args) { 
        Account acct = new Account(0);
        Customer c1 = new Customer(acct);
        Customer c2 = new Customer(acct);

        c1.setName("ç”²");
        c2.setName("ä¹™");

        c1.start();
        c2.start();
    }
}
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263
```

## 05ã€çº¿ç¨‹çš„é€šä¿¡

```java
/**
 * çº¿ç¨‹é€šä¿¡çš„ä¾‹å­ï¼šä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ‰“å°1-100ã€‚çº¿ç¨‹1, çº¿ç¨‹2 äº¤æ›¿æ‰“å°
 *
 * æ¶‰åŠåˆ°çš„ä¸‰ä¸ªæ–¹æ³•ï¼š
 * wait():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚
 * notify():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’è¢«waitçš„ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¢«waitï¼Œå°±å”¤é†’ä¼˜å…ˆçº§é«˜çš„é‚£ä¸ªã€‚
 * notifyAll():ä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’æ‰€æœ‰è¢«waitçš„çº¿ç¨‹ã€‚
 *
 * è¯´æ˜ï¼š
 *      1.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ã€‚
 *      2.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¯åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­çš„åŒæ­¥ç›‘è§†å™¨ã€‚
 *         å¦åˆ™ï¼Œä¼šå‡ºç°IllegalMonitorStateExceptionå¼‚å¸¸
 *      3.wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨java.lang.Objectç±»ä¸­ã€‚
 */

class Number implements Runnable{ 

    private int number = 1;
    public Object obj = new Object();

    @Override
    public void run() { 

        while (true){ 
            synchronized (obj) { 

                obj.notify();

                if(number <= 100){ 

                    try { 
                        Thread.sleep(10);
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                    System.out.println(Thread.currentThread().getName() + ":" + number);
                    number++;

                    try { 
                        //ä½¿å¾—è°ƒç”¨å¦‚ä¸‹wait()æ–¹æ³•çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€
                        obj.wait();
                    } catch (InterruptedException e) { 
                        e.printStackTrace();
                    }

                }else{ 
                    break;
                }
            }
        }
    }
}

public class CommunicationTest { 
    public static void main(String[] args) { 
        Number number = new Number();
        Thread t1 = new Thread(number);
        Thread t2 = new Thread(number);

        t1.setName("çº¿ç¨‹1");
        t2.setName("çº¿ç¨‹2");

        t1.start();
        t2.start();
    }
}
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667
```

## 5.1ã€sleep()å’Œwait()çš„å¼‚åŒ

```java
 /**
 * é¢è¯•é¢˜ï¼šsleep() å’Œ wait()çš„å¼‚åŒï¼Ÿ
 * 1.ç›¸åŒç‚¹ï¼šä¸€æ—¦æ‰§è¡Œæ–¹æ³•ï¼Œéƒ½å¯ä»¥ä½¿å¾—å½“å‰çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚
 * 2.ä¸åŒç‚¹ï¼š1ï¼‰ä¸¤ä¸ªæ–¹æ³•å£°æ˜çš„ä½ç½®ä¸åŒï¼šThreadç±»ä¸­å£°æ˜sleep() , Objectç±»ä¸­å£°æ˜wait()
 *          2ï¼‰è°ƒç”¨çš„è¦æ±‚ä¸åŒï¼šsleep()å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœºæ™¯ä¸‹è°ƒç”¨ã€‚ wait()å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­
 *          3ï¼‰å…³äºæ˜¯å¦é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ï¼šå¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œsleep()ä¸ä¼šé‡Šæ”¾é”ï¼Œwait()ä¼šé‡Šæ”¾é”ã€‚
 */
1234567
```

## 5.2ã€ç»å…¸ä¾‹é¢˜ï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…é—®é¢˜

![](assets/ac291433d4e2f43d4517b1b92043e95a-20220603152651-ag6ifl6.png)

```java
/**
 * çº¿ç¨‹é€šä¿¡çš„åº”ç”¨ï¼šç»å…¸ä¾‹é¢˜ï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…é—®é¢˜
 *
 * ç”Ÿäº§è€…(Productor)å°†äº§å“äº¤ç»™åº—å‘˜(Clerk)ï¼Œè€Œæ¶ˆè´¹è€…(Customer)ä»åº—å‘˜å¤„å–èµ°äº§å“ï¼Œ
 * åº—å‘˜ä¸€æ¬¡åªèƒ½æŒæœ‰å›ºå®šæ•°é‡çš„äº§å“(æ¯”å¦‚:20ï¼‰ï¼Œå¦‚æœç”Ÿäº§è€…è¯•å›¾ç”Ÿäº§æ›´å¤šçš„äº§å“ï¼Œ
 * åº—å‘˜ä¼šå«ç”Ÿäº§è€…åœä¸€ä¸‹ï¼Œå¦‚æœåº—ä¸­æœ‰ç©ºä½æ”¾äº§å“äº†å†é€šçŸ¥ç”Ÿäº§è€…ç»§ç»­ç”Ÿäº§ï¼›
 * å¦‚æœåº—ä¸­æ²¡æœ‰äº§å“äº†ï¼Œåº—å‘˜ä¼šå‘Šè¯‰æ¶ˆè´¹è€…ç­‰ä¸€ä¸‹ï¼Œ
 * å¦‚æœåº—ä¸­æœ‰äº§å“äº†å†é€šçŸ¥æ¶ˆè´¹è€…æ¥å–èµ°äº§å“ã€‚
 *
 * åˆ†æï¼š
 *      1.æ˜¯å¦æ˜¯å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Ÿæ˜¯ï¼Œç”Ÿäº§è€…çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…çš„çº¿ç¨‹
 *      2.æ˜¯å¦æœ‰å…±äº«æ•°æ®çš„é—®é¢˜ï¼Ÿæ˜¯ï¼Œåº—å‘˜ã€äº§å“ã€äº§å“æ•°
 *      3.å¦‚ä½•è§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ï¼ŸåŒæ­¥æœºåˆ¶ï¼Œæœ‰ä¸‰ç§æ–¹æ³•
 *      4.æ˜¯å¦æ¶‰åŠçº¿ç¨‹çš„é€šä¿¡ï¼Ÿæ˜¯
 */

class Clerk{ 

    private int productCount = 0;

    //ç”Ÿäº§äº§å“
    public synchronized void produceProduct() { 

        if(productCount < 20){ 
            productCount++;
            System.out.println(Thread.currentThread().getName() + ": å¼€å§‹ç”Ÿäº§ç¬¬" + productCount + "ä¸ªäº§å“");

            notify();
        }else{ 
            //ç­‰å¾…
            try { 
                wait();
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }
        }

    }

    //æ¶ˆè´¹äº§å“
    public synchronized void consumeProduct() { 

        if(productCount > 0){ 
            System.out.println(Thread.currentThread().getName() + ":å¼€å§‹æ¶ˆè´¹ç¬¬" + productCount + "ä¸ªäº§å“");
            productCount--;

            notify();
        }else{ 
            //ç­‰å¾…
            try { 
                wait();
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }
        }
    }

}

class Producer extends Thread{ //ç”Ÿäº§è€…
    private Clerk clerk;

    public Producer(Clerk clerk){ 
        this.clerk = clerk;
    }

    @Override
    public void run() { 
        System.out.println(getName() + ": å¼€å§‹ç”Ÿäº§äº§å“......");

        while(true){ 

            try { 
                Thread.sleep(10);
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }

            clerk.produceProduct();
        }
    }
}

class Consumer extends Thread{   //æ¶ˆè´¹è€…
    private Clerk clerk;

    public Consumer(Clerk clerk){ 
        this.clerk = clerk;
    }

    @Override
    public void run() { 
        System.out.println(getName() + ": å¼€å§‹æ¶ˆè´¹äº§å“......");

        while(true){ 

            try { 
                Thread.sleep(20);
            } catch (InterruptedException e) { 
                e.printStackTrace();
            }

            clerk.consumeProduct();
        }

    }
}

public class ProductTest { 
    public static void main(String[] args) { 
        Clerk clerk = new Clerk();

        Producer p1 = new Producer(clerk);
        p1.setName("ç”Ÿäº§è€…1");

        Consumer c1 = new Consumer(clerk);
        c1.setName("æ¶ˆè´¹è€…1");
        Consumer c2 = new Consumer(clerk);
        c2.setName("æ¶ˆè´¹è€…2");

        p1.start();
        c1.start();
        c2.start();
    }
}			
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125
```

## 06ã€JDK5.0æ–°å¢çº¿ç¨‹åˆ›å»ºæ–¹å¼

## 6.1ã€åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£

```java
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;

/**
 * åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£ ---> JDK 5.0æ–°å¢
 *
 * å¦‚ä½•ç†è§£å®ç°Callableæ¥å£çš„æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹æ¯”å®ç°Runnableæ¥å£åˆ›å»ºå¤šçº¿ç¨‹æ–¹å¼å¼ºå¤§ï¼Ÿ
 *      1.call()å¯ä»¥æœ‰è¿”å›å€¼çš„ã€‚
 *      2.call()å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¢«å¤–é¢çš„æ“ä½œæ•è·ï¼Œè·å–å¼‚å¸¸çš„ä¿¡æ¯
 *      3.Callableæ˜¯æ”¯æŒæ³›å‹çš„
 *      4.éœ€è¦å€ŸåŠ©FutureTaskç±»ï¼Œæ¯”å¦‚è·å–è¿”å›ç»“æœ
 */
//1.åˆ›å»ºä¸€ä¸ªå®ç°Callableçš„å®ç°ç±»
class NumThread implements Callable{ 

    //2.å®ç°callæ–¹æ³•ï¼Œå°†æ­¤çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨call()ä¸­
    @Override
    public Object call() throws Exception { 
        int sum = 0;
        for(int i = 1;i <= 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(i);
                sum += i;
            }
        }
        return sum;
    }
}

public class ThreadNew { 
    public static void main(String[] args) { 
        //3.åˆ›å»ºCallableæ¥å£å®ç°ç±»çš„å¯¹è±¡
        NumThread numThread = new NumThread();

        //4.å°†æ­¤Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºä¼ é€’åˆ°FutureTaskæ„é€ å™¨ä¸­ï¼Œåˆ›å»ºFutureTaskçš„å¯¹è±¡
        FutureTask futureTask = new FutureTask(numThread);

        //5.å°†FutureTaskçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œå¹¶è°ƒç”¨start()
        new Thread(futureTask).start();

        try { 
            //6.è·å–Callableä¸­callæ–¹æ³•çš„è¿”å›å€¼
            //get()è¿”å›å€¼å³ä¸ºFutureTaskæ„é€ å™¨å‚æ•°Callableå®ç°ç±»é‡å†™çš„call()çš„è¿”å›å€¼ã€‚
            Object sum = futureTask.get();
            System.out.println("æ€»å’Œä¸º:" + sum);
        } catch (InterruptedException e) { 
            e.printStackTrace();
        } catch (ExecutionException e) { 
            e.printStackTrace();
        }
    }
}
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253
```

> `Future`æ¥å£
>

* å¯ä»¥å¯¹å…·ä½“`Runnableã€Callable`ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœç­‰ã€‚
* `FutrueTask`æ˜¯`Futrue`æ¥å£çš„å”¯ä¸€çš„å®ç°ç±»
* `FutureTask`åŒæ—¶å®ç°äº†`Runnable, Future`æ¥å£ã€‚å®ƒæ—¢å¯ä»¥ä½œä¸º`Runnable`è¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸º`Future`å¾—åˆ°`Callable`çš„è¿”å›å€¼

## 6.2ã€ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„

> 1ã€ **èƒŒæ™¯** ï¼š
>

ç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚

> 2ã€ **æ€è·¯** ï¼š
>

æå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–ï¼Œä½¿ç”¨å®Œæ”¾å›æ± ä¸­ã€‚å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€å®ç°é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å…¬å…±äº¤é€šå·¥å…·ã€‚

> 3ã€ **å¥½å¤„** ï¼š
>

* æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰
* é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰
* ä¾¿äºçº¿ç¨‹ç®¡ç†

  * `corePoolSize`ï¼šæ ¸å¿ƒæ± çš„å¤§å°
  * `maximumPoolSize`ï¼šæœ€å¤§çº¿ç¨‹æ•°
  * `keepAliveTime`ï¼šçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´åä¼šç»ˆæ­¢
  * â€¦

## 6.3ã€åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± 

```java
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.ThreadPoolExecutor;

/**
 * åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± 
 *
 * å¥½å¤„ï¼š
 *      1.æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰
 *      2.é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰
 *      3.ä¾¿äºçº¿ç¨‹ç®¡ç†
 *          corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°
 *          maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°
 *          keepAliveTimeï¼šçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´åä¼šç»ˆæ­¢
 *
 * é¢è¯•é¢˜ï¼šåˆ›å»ºå¤šçº¿ç¨‹æœ‰å‡ ç§æ–¹å¼ï¼Ÿå››ç§ï¼
 */

class NumberThread implements Runnable{ 
    @Override
    public void run() { 
        for(int i = 0;i <= 100;i++){ 
            if(i % 2 == 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}

class NumberThread1 implements Runnable{ 
    @Override
    public void run() { 
        for(int i = 0;i <= 100;i++){ 
            if(i % 2 != 0){ 
                System.out.println(Thread.currentThread().getName() + ":" + i);
            }
        }
    }
}

public class ThreadPool { 
    public static void main(String[] args) { 

        //1. æä¾›æŒ‡å®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± 
        ExecutorService service = Executors.newFixedThreadPool(10);
        ThreadPoolExecutor service1 = (ThreadPoolExecutor) service;
        //è®¾ç½®çº¿ç¨‹æ± çš„å±æ€§
//        System.out.println(service.getClass());
//        service1.setCorePoolSize(15);
//        service1.setKeepAliveTime();

        //2.æ‰§è¡ŒæŒ‡å®šçš„çº¿ç¨‹çš„æ“ä½œã€‚éœ€è¦æä¾›å®ç°Runnableæ¥å£æˆ–Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡
        service.execute(new NumberThread());  //é€‚åˆé€‚ç”¨äºRunable
        service.execute(new NumberThread1());  //é€‚åˆé€‚ç”¨äºRunable

//        service.submit(Callable callable);   //é€‚åˆé€‚ç”¨äºCallable

        //3.å…³é—­è¿æ¥æ± 
        service.shutdown();
    }
}
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061
```

* çº¿ç¨‹æ± ç›¸å…³API

  * JDK 5.0èµ·æä¾›äº†çº¿ç¨‹æ± ç›¸å…³APIï¼š**`ExecutorService`**å’Œ**`Executors`**
* `ExecutorService`ï¼šçœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚å¸¸è§å­ç±»`ThreadPoolExecutor`

  * `void execute(Runnable command)` ï¼šæ‰§è¡Œä»»åŠ¡/å‘½ä»¤ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œ`Runnable`
  * `Future submit(Callable task)`ï¼šæ‰§è¡Œä»»åŠ¡ï¼Œæœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬åˆæ¥æ‰§è¡Œ`Callable`
  * `void shutdown()`ï¼šå…³é—­è¿æ¥æ± 
* `Executors`ï¼šå·¥å…·ç±»ã€çº¿ç¨‹æ± çš„å·¥å‚ç±»ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›ä¸åŒç±»å‹çš„çº¿ç¨‹æ± 

  * `Executors.newCachedThreadPool(`)ï¼šåˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± 
  * `Executors.newFixedThreadPool(n)`; åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± 
  * `Executors.newSingleThreadExecutor()`ï¼šåˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± 
  * `Executors.newScheduledThreadPool(n)`ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚

> ä½œè€…åšç¬”è®°ä¸å®¹æ˜“ï¼Œè¯·è¯„ä¸ªåˆ†å§ï¼
>

* 1ã€å¦‚æœè§‰å¾—æ–‡ç« å†™è¡Œä¸é”™å°±ç‚¹ä¸ª  **èµ** ã€‚âœŒ
* 2ã€å¦‚æœè§‰å¾—å†™å¾—å¥½å°±  **ä¸€é”®ä¸‰è¿** ï¼âœŒâœŒâœŒ
* 3ã€å¦‚æœæ–‡ç« å¯¹ä½ å¾ˆæœ‰å¸®åŠ©ï¼Œè¯·  **æ‰“èµ** ã€‚ ğŸ’ƒğŸ’ƒğŸ’ƒğŸ’ƒğŸ’ƒ
